<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpTaS: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpTaS
   &#160;<span id="projectnumber">1.0.7</span>
   </div>
   <div id="projectbrief">An optimization-based task specification library for trajectory optimization and model predictive control.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OpTaS Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p align="center"><a class="anchor" id="md_mainpage"></a> </p>
<p><img src="https://raw.githubusercontent.com/cmower/optas/master/doc/logo.png" alt="" width="60" align="right" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md0"></a>
OpTaS</h1>
<p><a href="https://github.com/psf/black"><img src="https://img.shields.io/badge/code%20style-black-000000.svg" alt="Code style: black" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/cmower/optas/actions/workflows/black.yaml"><img src="https://github.com/cmower/optas/actions/workflows/black.yaml/badge.svg" alt="Lint" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/cmower/optas/actions/workflows/pytest.yaml"><img src="https://github.com/cmower/optas/actions/workflows/pytest.yaml/badge.svg" alt="Run tests" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/cmower/optas/actions/workflows/documentation.yaml"><img src="https://github.com/cmower/optas/actions/workflows/documentation.yaml/badge.svg" alt="Build documentation" style="pointer-events: none;" class="inline"/></a></p>
<p>OpTaS is an OPtimization-based TAsk Specification library for trajectory optimization and model predictive control.</p>
<ul>
<li>Code: <a href="https://github.com/cmower/optas">https://github.com/cmower/optas</a></li>
<li>Documentation: <a href="https://cmower.github.io/optas/">https://cmower.github.io/optas/</a></li>
<li>PyPI: <a href="https://pypi.org/project/pyoptas/">https://pypi.org/project/pyoptas/</a></li>
<li>Issues: <a href="https://github.com/cmower/optas/issues">https://github.com/cmower/optas/issues</a></li>
<li>ICRA 2023 paper:<ul>
<li>(arXiv) <a href="https://arxiv.org/abs/2301.13512">https://arxiv.org/abs/2301.13512</a></li>
<li>(ieee) <a href="https://ieeexplore.ieee.org/document/10161272">https://ieeexplore.ieee.org/document/10161272</a></li>
</ul>
</li>
<li>Video: <a href="https://youtu.be/gCMNOenFngU">https://youtu.be/gCMNOenFngU</a></li>
<li>Presentation: <a href="https://vimeo.com/824802366">https://vimeo.com/824802366</a></li>
</ul>
<p>In the past, OpTaS supported ROS from an internal module. This functionality, with additional updates, has now been moved to a dedicated repository: <a href="https://github.com/cmower/optas_ros">optas_ros</a>.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Example</h1>
<p><img src="https://raw.githubusercontent.com/cmower/optas/master/doc/image/kuka_example.png" alt="" width="61.803398875%" class="inline"/> </p>
<p>In this example we implement an optimization-based IK problem. The problem computes an optimal joint configuration \(q^*\in\mathbb{R}^n\) given by</p>
<p class="formulaDsp">
\[ q^* = \underset{q}{\text{arg}\min}~\|q - q_N\|^2\quad\text{subject to}\quad p(q) = p_g, q^-\leq q \leq q^+ \]
</p>
<p>where</p><ul>
<li>\(q\in\mathbb{R}^n\) is the joint configuration for an \(n\)-dof robot (in our example, we use the KUKA LWR in the above figure with \(n=7\)),</li>
<li>\(q_N\in\mathbb{R}^n\) is a nominal joint configuration,</li>
<li>\(\|\cdot\|\) is the Euclidean norm,</li>
<li>\(p: \mathbb{R}^n\rightarrow\mathbb{R}^3\) computes the end-effector position via the forward kinematics,</li>
<li>\(p_g\in\mathbb{R}^3\) is a goal position, and</li>
<li>\(q^-, q^+\in\mathbb{R}^n\) is the lower and upper joint position limits respectively.</li>
</ul>
<p>The example problem has a quadratic cost function with nonlinear constraints. We use the nominal configuration \(q_N\) as the initial seed for the problem.</p>
<p>The following example script showcases some of the main features of OpTaS: creating a robot model, building an optimization problem, passing the problem to a solver, computing an optimal solution, and visualizing the robot in a given configuration.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> os</div>
<div class="line"><span class="keyword">import</span> pathlib</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> optas</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Specify URDF filename</span></div>
<div class="line">cwd = pathlib.Path(__file__).parent.resolve()  <span class="comment"># path to current working directory</span></div>
<div class="line">urdf_filename = os.path.join(</div>
<div class="line">    cwd, <span class="stringliteral">&quot;robots&quot;</span>, <span class="stringliteral">&quot;kuka_lwr&quot;</span>, <span class="stringliteral">&quot;kuka_lwr.urdf&quot;</span></div>
<div class="line">)  <span class="comment"># KUKA LWR, 7-DoF</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Setup robot model</span></div>
<div class="line">robot = <a class="code" href="classoptas_1_1models_1_1RobotModel.html">optas.RobotModel</a>(urdf_filename=urdf_filename)</div>
<div class="line">name = robot.get_name()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Setup optimization builder</span></div>
<div class="line">T = 1</div>
<div class="line">builder = <a class="code" href="classoptas_1_1builder_1_1OptimizationBuilder.html">optas.OptimizationBuilder</a>(T, robots=robot)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Setup parameters</span></div>
<div class="line">qn = builder.add_parameter(<span class="stringliteral">&quot;q_nominal&quot;</span>, robot.ndof)</div>
<div class="line">pg = builder.add_parameter(<span class="stringliteral">&quot;p_goal&quot;</span>, 3)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Constraint: end goal</span></div>
<div class="line">q = builder.get_model_state(name, 0)</div>
<div class="line">end_effector_name = <span class="stringliteral">&quot;end_effector_ball&quot;</span></div>
<div class="line">p = robot.get_global_link_position(end_effector_name, q)</div>
<div class="line">builder.add_equality_constraint(<span class="stringliteral">&quot;end_goal&quot;</span>, p, pg)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Cost: nominal configuration</span></div>
<div class="line">builder.add_cost_term(<span class="stringliteral">&quot;nominal&quot;</span>, optas.sumsqr(q - qn))</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Constraint: joint position limits</span></div>
<div class="line">builder.enforce_model_limits(name)  <span class="comment"># joint limits extracted from URDF</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Build optimization problem</span></div>
<div class="line">optimization = builder.build()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Interface optimization problem with a solver</span></div>
<div class="line">solver = <a class="code" href="classoptas_1_1solver_1_1CasADiSolver.html">optas.CasADiSolver</a>(optimization).setup(<span class="stringliteral">&quot;ipopt&quot;</span>)</div>
<div class="line"><span class="comment"># solver = optas.ScipyMinimizeSolver(optimization).setup(&quot;SLSQP&quot;)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Specify a nominal configuration</span></div>
<div class="line">q_nominal = <a class="code" href="namespaceoptas.html#ab47d1de31fc861cf18fa771121c7de3b">optas.deg2rad</a>([0, 45, 0, -90, 0, -45, 0])</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Get end-effector position in nominal configuration</span></div>
<div class="line">p_nominal = robot.get_global_link_position(end_effector_name, q_nominal)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Specify a goal end-effector position</span></div>
<div class="line">p_goal = p_nominal + optas.DM([0.0, 0.3, -0.2])</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Reset solver parameters</span></div>
<div class="line">solver.reset_parameters({<span class="stringliteral">&quot;q_nominal&quot;</span>: q_nominal, <span class="stringliteral">&quot;p_goal&quot;</span>: p_goal})</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Reset initial seed</span></div>
<div class="line">solver.reset_initial_seed({f<span class="stringliteral">&quot;{name}/q&quot;</span>: q_nominal})</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Compute a solution</span></div>
<div class="line">solution = solver.solve()</div>
<div class="line">q_solution = solution[f<span class="stringliteral">&quot;{name}/q&quot;</span>]</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Visualize the robot</span></div>
<div class="line">vis = <a class="code" href="classoptas_1_1visualize_1_1Visualizer.html">optas.Visualizer</a>(quit_after_delay=2.0)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Draw goal position and start visualizer</span></div>
<div class="line">vis.sphere(0.05, rgb=[0, 1, 0], position=p_goal.toarray().flatten().tolist())</div>
<div class="line"><span class="comment"># vis.robot(robot, q=q_nominal,display_link_names=True,show_links=True)   # nominal</span></div>
<div class="line">vis.robot(robot, q=q_solution, display_link_names=<span class="keyword">True</span>, show_links=<span class="keyword">True</span>)  <span class="comment"># solution</span></div>
<div class="line"> </div>
<div class="line">vis.start()</div>
<div class="ttc" id="aclassoptas_1_1builder_1_1OptimizationBuilder_html"><div class="ttname"><a href="classoptas_1_1builder_1_1OptimizationBuilder.html">optas.builder.OptimizationBuilder</a></div><div class="ttdoc">OptimizationBuilder allows you to build/specify an optimization problem.</div><div class="ttdef"><b>Definition:</b> builder.py:11</div></div>
<div class="ttc" id="aclassoptas_1_1models_1_1RobotModel_html"><div class="ttname"><a href="classoptas_1_1models_1_1RobotModel.html">optas.models.RobotModel</a></div><div class="ttdoc">A class that defines a robot model.</div><div class="ttdef"><b>Definition:</b> models.py:233</div></div>
<div class="ttc" id="aclassoptas_1_1solver_1_1CasADiSolver_html"><div class="ttname"><a href="classoptas_1_1solver_1_1CasADiSolver.html">optas.solver.CasADiSolver</a></div><div class="ttdoc">This is a base class for CasADi solver interfaces.</div><div class="ttdef"><b>Definition:</b> solver.py:321</div></div>
<div class="ttc" id="aclassoptas_1_1visualize_1_1Visualizer_html"><div class="ttname"><a href="classoptas_1_1visualize_1_1Visualizer.html">optas.visualize.Visualizer</a></div><div class="ttdoc">This class defines the Visualizer for simple visualization.</div><div class="ttdef"><b>Definition:</b> visualize.py:77</div></div>
<div class="ttc" id="anamespaceoptas_html_ab47d1de31fc861cf18fa771121c7de3b"><div class="ttname"><a href="namespaceoptas.html#ab47d1de31fc861cf18fa771121c7de3b">optas.deg2rad</a></div><div class="ttdeci">Union[cs.DM, cs.SX] deg2rad(ArrayType x)</div><div class="ttdoc">Convert degrees to radians.</div><div class="ttdef"><b>Definition:</b> __init__.py:11</div></div>
</div><!-- fragment --><p> Run the example script <a href="example/example.py">example.py</a>. Other examples, including dual-arm planning, Model Predictive Control, Trajectory Optimization, etc can be found in the [example/](example) directory.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Support</h1>
<p>The following operating systems and python versions are <a href="https://github.com/cmower/optas/blob/master/.github/workflows/pytest.yaml">officially supported</a>:</p>
<ul>
<li>Ubuntu 20.04 and 22.04<ul>
<li>Python 3.7, 3.8, 3.9</li>
</ul>
</li>
<li>Windows<ul>
<li>Python 3.8, 3.9</li>
</ul>
</li>
<li>Mac OS<ul>
<li>Python 3.9</li>
</ul>
</li>
</ul>
<p>Note that OpTaS makes use of <a href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a> that was <a href="https://peps.python.org/pep-0557/">introduced in Python 3.7</a>, and so Python versions from 3.6 and lower are not supported on any operating system. Other operating systems or higher Python versions will likely work. If you experience problems, please <a href="https://github.com/cmower/optas/issues/new/choose">submit an issue</a>.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Install</h1>
<p>Make sure <code>pip</code> is up-to-date by running <code>$ python -m pip install --upgrade pip</code>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Via pip</h2>
<div class="fragment"><div class="line">$ pip install pyoptas</div>
</div><!-- fragment --><p> Alternatively, you can also install OpTaS using:</p>
<p>$ python -m pip install 'optas @ git+https://github.com/cmower/optas.git'  </p>
<h2><a class="anchor" id="autotoc_md5"></a>
From source</h2>
<ol type="1">
<li><code>$ git clone --recursive git@github.com:cmower/optas.git</code> (if you do not want to build the documentation then the <code>--recursive</code> flag is not necessary)</li>
<li><code>$ cd optas</code></li>
<li><code>$ pip install .</code><ul>
<li>if you want to run the examples use: <code>$ pip install .[example]</code></li>
<li>if you want to run the tests use: <code>$ pip install .[test]</code></li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md6"></a>
Build documentation</h3>
<ol type="1">
<li><code>$ cd /path/to/optas/doc</code></li>
<li><code>$ sudo apt install doxygen graphviz</code></li>
<li><code>$ python gen_mainpage.py</code></li>
</ol>
<ol type="1">
<li><code>$ doxygen</code></li>
<li>Open the documentation in either HTML or PDF:<ul>
<li><code>html/index.html</code></li>
<li><code>latex/refman.pdf</code></li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md7"></a>
Run tests</h3>
<ol type="1">
<li><code>$ cd /path/to/optas</code></li>
<li>Each test can be run as follows<ul>
<li><code>$ pytest tests/test_builder.py</code></li>
<li><code>$ pytest tests/test_examples.py</code></li>
<li><code>$ pytest tests/test_models.py</code></li>
<li><code>$ pytest tests/test_optas_utils.py</code></li>
<li><code>$ pytest tests/test_optimization.py</code></li>
<li><code>$ pytest tests/test_solver.py</code></li>
<li><code>$ pytest tests/test_spatialmath.py</code></li>
<li><code>$ pytest tests/test_sx_container.py</code></li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md8"></a>
Known Issues</h1>
<ul>
<li>Loading robot models from xacro files is supported, however there can be issues if you are running this in a ROS agnositic environment. If you do not have ROS installed, then the xacro file should not contain ROS-specific features. For further details see <a href="https://github.com/cmower/optas/issues/78">here</a>.</li>
<li>If NumPy ver 1.24 is installed, an <code>AttributeError</code> error is thrown when you try to solve an unconstrained problem with the OSQP interface. A temporary workaround is to add a constraint, e.g. <code>x &gt;= -1e9</code> where <code>x</code> is a decision variable. See details on the issue <a href="https://github.com/osqp/osqp-python/issues/104">here</a> and pull request <a href="https://github.com/osqp/osqp-python/pull/105">here</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Citation</h1>
<p>If you use OpTaS in your work, please consider including the following citation.</p>
<div class="fragment"><div class="line">@inproceedings{mower23optas,</div>
<div class="line">  author={Mower, Christopher E. and Moura, João and Behabadi, Nazanin Zamani and Vijayakumar, Sethu and Vercauteren, Tom and Bergeles, Christos},</div>
<div class="line">  booktitle={2023 IEEE International Conference on Robotics and Automation (ICRA)},</div>
<div class="line">  title={OpTaS: An Optimization-based Task Specification Library for Trajectory Optimization and Model Predictive Control},</div>
<div class="line">  year={2023},</div>
<div class="line">  volume={},</div>
<div class="line">  number={},</div>
<div class="line">  pages={9118-9124},</div>
<div class="line">  doi={10.1109/ICRA48891.2023.10161272}</div>
<div class="line">}</div>
</div><!-- fragment --><p> The preprint can be found on <a href="https://arxiv.org/abs/2301.13512">arXiv</a>.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Contributing</h1>
<p>We welcome contributions from the community. If you come across any issues or inacuracies in the documentation, please <a href="https://github.com/cmower/optas/issues/new/choose">submit an issue</a>. If you would like to contribute any new features, please <a href="https://github.com/cmower/optas/fork">fork the repository</a>, and submit a pull request.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Acknowledgement</h1>
<p>This research received funding from the European Union’s Horizon 2020 research and innovation program under grant agreement No. 101016985 (<a href="https://h2020faros.eu/">FAROS</a>). Further, this work was supported by core funding from the Wellcome/EPSRC [WT203148/Z/16/Z; NS/A000049/1]. T. Vercauteren is supported by a Medtronic / RAEng Research Chair [RCSRF1819\7\34], and C. Bergeles by an ERC Starting Grant [714562]. This work has received funding from the European Union’s Horizon 2020 research and innovation programme under grant agreement No 101017008, Enhancing Healthcare with Assistive Robotic Mobile Manipulation (<a href="https://harmony-eu.org/">HARMONY</a>).</p>
<p><img src="https://raw.githubusercontent.com/cmower/optas/master/eu.png" alt="" width="180" align="left" class="inline"/> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
